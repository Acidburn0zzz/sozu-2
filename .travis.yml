language: c
script:
    - git config --global user.name "Haskell Pushbot"
    - git config --global user.email "haskell-pushbot@$(hostname)"
    - git config --global push.default simple
    - gcc main.c -o main
    - cp id_rsa $HOME/.ssh/id_rsa
    - chmod 0600 $HOME/.ssh/id_rsa
    - mkdir binaries
    - git rev-parse HEAD > commit-id
    - cd binaries
    - git init
    - git remote add origin git@github.com:ezyang/sozu.git
    - cp ../main main
    - git add .
    - git commit -m "Autopush"
    - git push -f origin HEAD:rev-$(cat ../commit-id)
